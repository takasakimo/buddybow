generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id                Int                @id @default(autoincrement())
  email             String             @unique
  password          String
  name              String
  role              String             @default("user")
  createdAt         DateTime           @default(now()) @map("created_at")
  updatedAt         DateTime           @updatedAt @map("updated_at")
  
  // マイページ関連
  userProgress      UserProgress?
  diagnoses         Diagnosis[]
  roadmaps          Roadmap[]
  dailyReports      DailyReport[]
  consultations     Consultation[]
  achievements      Achievement[]
  motivationMessages MotivationMessage[]

  @@map("users")
}

// お知らせ
model Announcement {
  id          String   @id @default(cuid())
  title       String
  content     String
  category    String   // news, event, update
  isPublished Boolean  @default(true) @map("is_published")
  publishedAt DateTime @default(now()) @map("published_at")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("announcements")
}

// 勉強会
model StudySession {
  id          String   @id @default(cuid())
  title       String
  description String?
  startTime   DateTime @map("start_time")
  endTime     DateTime @map("end_time")
  location    String?  // オンライン/場所
  maxCapacity Int?     @map("max_capacity")
  status      String   @default("upcoming") // upcoming, ongoing, completed, cancelled
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("study_sessions")
}

// プログレス管理
model UserProgress {
  id              String   @id @default(cuid())
  userId          Int      @unique @map("user_id")
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  currentPhase    String   @map("current_phase")
  overallProgress Int      @default(0) @map("overall_progress")
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  @@map("user_progress")
}

// 診断結果
model Diagnosis {
  id              String   @id @default(cuid())
  userId          Int      @map("user_id")
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  personalityType String?  @map("personality_type")
  skillMap        Json?    @map("skill_map")
  strengths       Json?    @map("strengths")
  weaknesses      Json?    @map("weaknesses")
  recommendations Json?    @map("recommendations")
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  @@map("diagnoses")
}

// ロードマップ
model Roadmap {
  id              String      @id @default(cuid())
  userId          Int         @map("user_id")
  user            User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  title           String
  description     String?
  targetMonths    Int         @map("target_months")
  startDate       DateTime    @map("start_date")
  endDate         DateTime    @map("end_date")
  milestones      Milestone[]
  createdAt       DateTime    @default(now()) @map("created_at")
  updatedAt       DateTime    @updatedAt @map("updated_at")

  @@map("roadmaps")
}

// マイルストーン
model Milestone {
  id          String   @id @default(cuid())
  roadmapId   String   @map("roadmap_id")
  roadmap     Roadmap  @relation(fields: [roadmapId], references: [id], onDelete: Cascade)
  title       String
  description String?
  targetDate  DateTime @map("target_date")
  completed   Boolean  @default(false)
  completedAt DateTime? @map("completed_at")
  order       Int
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("milestones")
}

// 日報・週報
model DailyReport {
  id          String   @id @default(cuid())
  userId      Int      @map("user_id")
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  date        DateTime
  type        String
  workHours   Float?   @map("work_hours")
  revenue     Float?
  content     String
  challenges  String?
  learnings   String?
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("daily_reports")
}

// 相談・コミュニケーション
model Consultation {
  id          String   @id @default(cuid())
  userId      Int      @map("user_id")
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  title       String
  content     String
  status      String   @default("pending")
  answer      String?
  answeredAt  DateTime? @map("answered_at")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("consultations")
}

// 達成・バッジ
model Achievement {
  id          String   @id @default(cuid())
  userId      Int      @map("user_id")
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  title       String
  description String?
  badgeType   String   @map("badge_type")
  earnedAt    DateTime @default(now()) @map("earned_at")
  createdAt   DateTime @default(now()) @map("created_at")

  @@map("achievements")
}

// 応援メッセージ
model MotivationMessage {
  id        String   @id @default(cuid())
  userId    Int      @map("user_id")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  message   String
  fromAdmin Boolean  @default(true) @map("from_admin")
  createdAt DateTime @default(now()) @map("created_at")

  @@map("motivation_messages")
}

model Category {
  id        String     @id @default(cuid())
  name      String     @unique
  createdAt DateTime   @default(now()) @map("created_at")
  updatedAt DateTime   @updatedAt @map("updated_at")
  trainings Training[]

  @@map("categories")
}

model Training {
  id          String    @id @default(cuid())
  title       String
  description String?
  imageUrl    String?   @map("image_url")
  categoryId  String?   @map("category_id")
  category    Category? @relation(fields: [categoryId], references: [id])
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  modules     Module[]

  @@map("trainings")
}

model Module {
  id          String   @id @default(cuid())
  title       String
  description String?
  imageUrl    String?  @map("image_url")
  videoUrl    String?  @map("video_url")
  order       Int
  trainingId  String   @map("training_id")
  training    Training @relation(fields: [trainingId], references: [id], onDelete: Cascade)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("modules")
}

// チャプター進捗
model ModuleProgress {
  id          String   @id @default(cuid())
  userId      Int      @map("user_id")
  moduleId    String   @map("module_id")
  completed   Boolean  @default(false)
  completedAt DateTime? @map("completed_at")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@unique([userId, moduleId])
  @@map("module_progress")
}
